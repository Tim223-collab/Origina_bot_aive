# üèóÔ∏è System Patterns

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ì–∏–±—Ä–∏–¥–Ω–∞—è AI —Å–∏—Å—Ç–µ–º–∞

#### –ü—Ä–æ–±–ª–µ–º–∞
–û–¥–Ω–∞ –º–æ–¥–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á:
- DeepSeek –¥–µ—à–µ–≤ –Ω–æ —Å—Ä–µ–¥–Ω–∏–π –ø–æ –∫–∞—á–µ—Å—Ç–≤—É
- Claude –¥–æ—Ä–æ–≥–æ–π –Ω–æ —ç–º–ø–∞—Ç–∏—á–Ω—ã–π
- GPT —É–Ω–∏–≤–µ—Ä—Å–∞–ª–µ–Ω –Ω–æ –Ω–µ —Å–∞–º—ã–π –¥–µ—à–µ–≤—ã–π

#### –†–µ—à–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∑–∞–¥–∞—á:

```python
class HybridAIService:
    """
    –£–º–Ω—ã–π –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–∞–¥–∞—á–∏
    """
    
    def __init__(self):
        self.gemini = GeminiService()  # –û—Å–Ω–æ–≤–Ω–æ–π (–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π!)
        self.deepseek = DeepSeekService()  # Reasoning
        self.claude = ClaudeService()  # –≠–º–ø–∞—Ç–∏—è
    
    async def chat(self, message, context_type="general"):
        """–í—ã–±–∏—Ä–∞–µ—Ç –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ –∑–∞–¥–∞—á–∏"""
        
        if context_type == "emotional":
            # –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ -> Claude
            return await self.claude.chat(message)
        
        elif context_type == "reasoning":
            # –°–ª–æ–∂–Ω–∞—è –∑–∞–¥–∞—á–∞ -> DeepSeek Reasoner
            return await self.deepseek.reasoning_chat(message)
        
        else:
            # –û–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥ -> Gemini (–±–µ—Å–ø–ª–∞—Ç–Ω–æ!)
            return await self.gemini.chat(message)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üí∞ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–∞—Ç—ã (Gemini –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π)
- üéØ –õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
- üîÑ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏

### 2. –£–º–Ω–∞—è –ø–∞–º—è—Ç—å —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º

#### –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ–∫—É—â–∞—è –ø–∞–º—è—Ç—å - –ø—Ä–æ—Å—Ç—ã–µ key-value –ø–∞—Ä—ã:
- –ù–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ù–µ –Ω–∞—Ö–æ–¥–∏—Ç –ø–æ—Ö–æ–∂—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç

#### –†–µ—à–µ–Ω–∏–µ
–í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î —Å embeddings:

```python
class SmartMemoryService:
    """
    –£–º–Ω–∞—è –ø–∞–º—è—Ç—å —Å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º
    """
    
    def __init__(self):
        self.db = Database()  # SQLite
        self.vector_db = ChromaDB()  # –í–µ–∫—Ç–æ—Ä–Ω–∞—è –ë–î
        self.embeddings = EmbeddingsService()
    
    async def remember(self, user_id, fact, context=None):
        """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∞–∫—Ç —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ–º"""
        
        # –°–æ–∑–¥–∞–µ–º embedding
        vector = await self.embeddings.create(fact)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –≤–µ–∫—Ç–æ—Ä–Ω—É—é –ë–î
        await self.vector_db.add(
            id=f"{user_id}_{timestamp}",
            vector=vector,
            metadata={
                "user_id": user_id,
                "fact": fact,
                "context": context,
                "timestamp": datetime.now()
            }
        )
        
        # –î—É–±–ª–∏—Ä—É–µ–º –≤ SQLite –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
        await self.db.save_memory(user_id, fact)
    
    async def recall(self, user_id, query):
        """–ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏"""
        
        # –°–æ–∑–¥–∞–µ–º embedding –∑–∞–ø—Ä–æ—Å–∞
        query_vector = await self.embeddings.create(query)
        
        # –ò—â–µ–º –ø–æ—Ö–æ–∂–∏–µ —Ñ–∞–∫—Ç—ã
        results = await self.vector_db.search(
            vector=query_vector,
            filter={"user_id": user_id},
            limit=10
        )
        
        return results
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üîç –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ ("–ø–∏—Ü—Ü–∞" –Ω–∞–π–¥–µ—Ç "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è –µ–¥–∞")
- üß† –ö–æ–Ω—Ç–µ–∫—Å—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å
- üìä –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ñ–∞–∫—Ç–∞–º–∏

### 3. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç

#### –ü—Ä–æ–±–ª–µ–º–∞
–ë–æ—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏
- –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- –ù–µ –∑–∞–º–µ—á–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è

#### –†–µ—à–µ–Ω–∏–µ
–ê–Ω–∞–ª–∏–∑ —ç–º–æ—Ü–∏–π –∏ –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Ç–æ–Ω–∞:

```python
class EmotionalIntelligence:
    """
    –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
    """
    
    EMOTIONS = {
        "happy": ["—Ä–∞–¥–æ—Å—Ç—å", "—Å—á–∞—Å—Ç—å–µ", "–≤–µ—Å–µ–ª–æ"],
        "sad": ["–≥—Ä—É—Å—Ç–Ω–æ", "–ø–µ—á–∞–ª—å", "—Ç–æ—Å–∫–∞"],
        "angry": ["–∑–ª–æ—Å—Ç—å", "—Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ", "–±–µ—Å–∏—Ç"],
        "anxious": ["—Ç—Ä–µ–≤–æ–≥–∞", "–≤–æ–ª–Ω–µ–Ω–∏–µ", "—Å—Ç—Ä–∞—Ö"],
        "tired": ["—É—Å—Ç–∞–ª", "–≤—ã–º–æ—Ç–∞–Ω", "–Ω–µ—Ç —Å–∏–ª"]
    }
    
    async def analyze_emotion(self, message):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —ç–º–æ—Ü–∏—é –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏"""
        
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º AI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        prompt = f"""
        –û–ø—Ä–µ–¥–µ–ª–∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        
        –°–æ–æ–±—â–µ–Ω–∏–µ: "{message}"
        
        –í–µ—Ä–Ω–∏ JSON:
        {{
            "emotion": "happy|sad|angry|anxious|tired|neutral",
            "intensity": 0.0-1.0,
            "keywords": ["—Å–ª–æ–≤–∞ —É–∫–∞–∑—ã–≤–∞—é—â–∏–µ –Ω–∞ —ç–º–æ—Ü–∏—é"]
        }}
        """
        
        result = await self.ai.extract_json(message, prompt)
        return result
    
    async def adapt_response(self, response, emotion):
        """–ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ø–æ–¥ —ç–º–æ—Ü–∏—é"""
        
        if emotion == "sad":
            # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É
            return f"üíô {response}\n\n–Ø —Ä—è–¥–æ–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å."
        
        elif emotion == "happy":
            # –†–∞–¥—É–µ–º—Å—è –≤–º–µ—Å—Ç–µ
            return f"üòä {response}\n\n–ö—Ä—É—Ç–æ —á—Ç–æ —É —Ç–µ–±—è —Ö–æ—Ä–æ—à–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!"
        
        elif emotion == "tired":
            # –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –æ—Ç–¥–æ—Ö–Ω—É—Ç—å
            return f"{response}\n\n–ú–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–¥–æ—Ö–Ω—É—Ç—å? üåô"
        
        return response
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üíô –≠–º–ø–∞—Ç–∏—á–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ
- üéØ –ü–æ–¥—Ö–æ–¥—è—â–∏–π —Ç–æ–Ω –æ—Ç–≤–µ—Ç–∞
- ü§ù –û—â—É—â–µ–Ω–∏–µ —á—Ç–æ —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é—Ç

### 4. –ü—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

#### –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ–∫—É—â–∞—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–ª–∏—à–∫–æ–º –ø—Ä–æ—Å—Ç–∞—è:
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–∑ –≤ —á–∞—Å
- –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
- –°–ª—É—á–∞–π–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

#### –†–µ—à–µ–Ω–∏–µ
–£–º–Ω–∞—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º:

```python
class SmartProactivity:
    """
    –£–º–Ω–∞—è –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
    """
    
    async def should_act(self, user_id):
        """–†–µ—à–∞–µ—Ç –Ω—É–∂–Ω–æ –ª–∏ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –°–ï–ô–ß–ê–°"""
        
        # –°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        context = await self.gather_context(user_id)
        
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Ç—É–∞—Ü–∏—é
        situation = {
            "time": context["current_time"],
            "day_type": context["is_workday"],
            "last_activity": context["hours_since_last_msg"],
            "pending_tasks": context["urgent_reminders"],
            "mood_history": context["recent_emotions"],
            "patterns": context["learned_patterns"]
        }
        
        # AI —Ä–µ—à–∞–µ—Ç
        decision = await self.ai.analyze(f"""
        –ö–æ–Ω—Ç–µ–∫—Å—Ç: {situation}
        
        –ù—É–∂–Ω–æ –ª–∏ —Å–µ–π—á–∞—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ?
        –ï—Å–ª–∏ –¥–∞ - —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å?
        
        –û—Ç–≤–µ—Ç –≤ JSON:
        {{
            "should_act": true/false,
            "action_type": "reminder|suggestion|support|celebration",
            "message": "—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
        }}
        """)
        
        return decision
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üéØ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- ‚è∞ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
- üß† –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω—ã

### 5. –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞

#### –ü—Ä–æ–±–ª–µ–º–∞
–¢–µ–∫—É—â–∏–π –ø–∞—Ä—Å–µ—Ä –∂–µ—Å—Ç–∫–æ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–¥–Ω–æ–º—É —Å–∞–π—Ç—É:
- –°–ª–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Å–∞–π—Ç—ã
- –ö–æ–ø–∏–ø–∞—Å—Ç –∫–æ–¥–∞
- –¢—Ä—É–¥–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

#### –†–µ—à–µ–Ω–∏–µ
–ü–ª–∞–≥–∏–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–∞—Ä—Å–µ—Ä–æ–≤:

```python
class BaseParser:
    """–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ø–∞—Ä—Å–µ—Ä–∞"""
    
    async def login(self):
        raise NotImplementedError
    
    async def parse(self, **params):
        raise NotImplementedError
    
    async def extract_data(self, page):
        raise NotImplementedError


class WorkSiteParser(BaseParser):
    """–ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ —Å–∞–π—Ç–∞"""
    
    async def login(self):
        # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ª–æ–≥–∏–Ω–∞
        pass
    
    async def parse(self, date=None):
        # –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞
        pass


class ParserRegistry:
    """–†–µ–µ—Å—Ç—Ä –≤—Å–µ—Ö –ø–∞—Ä—Å–µ—Ä–æ–≤"""
    
    def __init__(self):
        self.parsers = {}
    
    def register(self, name, parser_class):
        """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä—Å–µ—Ä"""
        self.parsers[name] = parser_class
    
    def get(self, name):
        """–ü–æ–ª—É—á–∞–µ—Ç –ø–∞—Ä—Å–µ—Ä –ø–æ –∏–º–µ–Ω–∏"""
        return self.parsers.get(name)


# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
registry = ParserRegistry()
registry.register("work_site", WorkSiteParser)
registry.register("another_site", AnotherSiteParser)

# –ü–∞—Ä—Å–∏–º –Ω—É–∂–Ω—ã–π —Å–∞–π—Ç
parser = registry.get("work_site")
data = await parser.parse(date="2024-11-21")
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- üîå –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–∞—Ä—Å–µ—Ä—ã
- üéØ –ö–∞–∂–¥—ã–π –ø–∞—Ä—Å–µ—Ä –Ω–µ–∑–∞–≤–∏—Å–∏–º
- üîß –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –≤–µ–∑–¥–µ

**–ü—Ä–∞–≤–∏–ª–æ**: –ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å `created_at` –∏ `updated_at`.

**–ó–∞—á–µ–º**:
- –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤
- –ü–æ–∏—Å–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ß–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### 2. –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ

**–ü—Ä–∞–≤–∏–ª–æ**: –ù–µ —É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–∏–∑–∏—á–µ—Å–∫–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `deleted_at`.

**–ó–∞—á–µ–º**:
- –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
- –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### 3. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ JSON

**–ü—Ä–∞–≤–∏–ª–æ**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ JSON –ø–æ–ª–µ `metadata`.

**–ó–∞—á–µ–º**:
- –ì–∏–±–∫–æ—Å—Ç—å —Å—Ö–µ–º—ã
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å
- –ù–µ –Ω—É–∂–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏

### 4. User ID –≤–µ–∑–¥–µ

**–ü—Ä–∞–≤–∏–ª–æ**: –ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —á–µ—Ä–µ–∑ `user_id`.

**–ó–∞—á–µ–º**:
- –ú—É–ª—å—Ç–∏—é–∑–µ—Ä–Ω–æ—Å—Ç—å –≤ –±—É–¥—É—â–µ–º
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∫–æ–¥–∞

### 1. Service —Å–ª–æ–π

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö, handlers —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è.

```python
# ‚ùå –ü–ª–æ—Ö–æ - –ª–æ–≥–∏–∫–∞ –≤ handler
async def handle_message(update, context):
    user_id = update.effective_user.id
    message = update.message.text
    
    # –ö—É—á–∞ –ª–æ–≥–∏–∫–∏ –ø—Ä—è–º–æ –∑–¥–µ—Å—å
    response = await ai.chat(message)
    await db.save(user_id, response)
    await update.message.reply_text(response)

# ‚úÖ –•–æ—Ä–æ—à–æ - –ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–µ
async def handle_message(update, context):
    user_id = update.effective_user.id
    message = update.message.text
    
    response = await ai_service.process_message(user_id, message)
    await update.message.reply_text(response)
```

### 2. Async everywhere

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å–µ IO –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ.

### 3. Error handling

**–ü—Ä–∞–≤–∏–ª–æ**: –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –≤—ã–∑–æ–≤—ã –≤ try/except —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

```python
async def fetch_weather(city):
    try:
        response = await api.get_weather(city)
        return response
    except Exception as e:
        logger.error(f"Weather API error: {e}")
        return None
```

### 4. Type hints

**–ü—Ä–∞–≤–∏–ª–æ**: –í–µ–∑–¥–µ —Ç–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.

```python
async def remember(
    user_id: int, 
    fact: str, 
    context: Optional[Dict] = None
) -> bool:
    ...
```

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. Whitelist –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ ID –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ—Ç–∞.

### 2. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ

–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î.

### 3. –°–µ–∫—Ä–µ—Ç—ã –≤ .env

–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–∞—Ä–¥–∫–æ–¥–∏—Ç—å –∫–ª—é—á–∏.

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤

–ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å API –∫–ª—é—á–∏ –∏ –ø–∞—Ä–æ–ª–∏.

## –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–ø–æ–≥–æ–¥–∞, –∫—É—Ä—Å—ã).

### 2. –ë–∞—Ç—á–∏–Ω–≥

–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ AI API.

### 3. –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

–ó–∞–≥—Ä—É–∂–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ.

### 4. –û—á–µ—Ä–µ–¥–∏

–¢—è–∂–µ–ª—ã–µ –∑–∞–¥–∞—á–∏ (–ø–∞—Ä—Å–∏–Ω–≥) –≤ –æ—á–µ—Ä–µ–¥–∏.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 21.11.2024
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 21.11.2024
**–í–µ—Ä—Å–∏—è**: 2.0

