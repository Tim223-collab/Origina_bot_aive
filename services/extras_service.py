"""
ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตัะฒะธัั: ะฟะพะณะพะดะฐ, ะบัััั ะฒะฐะปัั, ัะฐะทะฒะปะตัะตะฝะธั
"""
import aiohttp
from typing import Dict, Optional
import random


class ExtrasService:
    """ะะพะฟะพะปะฝะธัะตะปัะฝัะต ะฟะพะปะตะทะฝัะต ััะฝะบัะธะธ"""
    
    def __init__(self):
        pass
    
    async def get_weather(self, city: str = "Moscow") -> Optional[str]:
        """
        ะะพะปััะฐะตั ะฟะพะณะพะดั ะดะปั ะณะพัะพะดะฐ (ัะตัะตะท wttr.in)
        """
        try:
            url = f"https://wttr.in/{city}?format=3&lang=ru"
            async with aiohttp.ClientSession() as session:
                async with session.get(url, timeout=aiohttp.ClientTimeout(total=10)) as response:
                    if response.status == 200:
                        weather = await response.text()
                        return weather.strip()
            return None
        except Exception as e:
            print(f"โ ะัะธะฑะบะฐ ะฟะพะปััะตะฝะธั ะฟะพะณะพะดั: {e}")
            return None
    
    async def get_exchange_rates(self, base: str = "USD") -> Optional[Dict]:
        """
        ะะพะปััะฐะตั ะบัััั ะฒะฐะปัั
        """
        try:
            # ะัะฟะพะปัะทัะตะผ ะฟัะฑะปะธัะฝะพะต API ะฆะ ะะค
            url = "https://www.cbr-xml-daily.ru/daily_json.js"
            async with aiohttp.ClientSession() as session:
                async with session.get(url, timeout=aiohttp.ClientTimeout(total=10)) as response:
                    if response.status == 200:
                        data = await response.json()
                        return {
                            "USD": data["Valute"]["USD"]["Value"],
                            "EUR": data["Valute"]["EUR"]["Value"],
                            "CNY": data["Valute"]["CNY"]["Value"],
                            "date": data["Date"]
                        }
            return None
        except Exception as e:
            print(f"โ ะัะธะฑะบะฐ ะฟะพะปััะตะฝะธั ะบัััะพะฒ: {e}")
            return None
    
    async def get_crypto_price(self, symbol: str = "BTC") -> Optional[Dict]:
        """
        ะะพะปััะฐะตั ัะตะฝั ะบัะธะฟัะพะฒะฐะปััั
        """
        try:
            url = f"https://api.coinbase.com/v2/prices/{symbol}-USD/spot"
            async with aiohttp.ClientSession() as session:
                async with session.get(url, timeout=aiohttp.ClientTimeout(total=10)) as response:
                    if response.status == 200:
                        data = await response.json()
                        return {
                            "symbol": symbol,
                            "price": data["data"]["amount"],
                            "currency": data["data"]["currency"]
                        }
            return None
        except Exception as e:
            print(f"โ ะัะธะฑะบะฐ ะฟะพะปััะตะฝะธั ัะตะฝั ะบัะธะฟัั: {e}")
            return None
    
    def get_random_fact(self) -> str:
        """
        ะะพะทะฒัะฐัะฐะตั ัะปััะฐะนะฝัะน ะธะฝัะตัะตัะฝัะน ัะฐะบั
        """
        facts = [
            "๐ง ะงะตะปะพะฒะตัะตัะบะธะน ะผะพะทะณ ะณะตะฝะตัะธััะตั ะพะบะพะปะพ 70,000 ะผััะปะตะน ะฒ ะดะตะฝั.",
            "๐ ะะพััะธั ะทะฐะฝะธะผะฐะตั ะฑะพะปะตะต 11% ะฒัะตะน ัััะธ ะฝะฐ ะะตะผะปะต.",
            "โก ะะพะปะฝะธั ะฒ 5 ัะฐะท ะณะพัััะตะต ะฟะพะฒะตััะฝะพััะธ ะกะพะปะฝัะฐ.",
            "๐ ะฃ ะพััะผะธะฝะพะณะฐ ััะธ ัะตัะดัะฐ ะธ ะณะพะปัะฑะฐั ะบัะพะฒั.",
            "๐ ะะฐ ะัะฝะต ะฝะตั ะฐัะผะพััะตัั, ะฟะพััะพะผั ัะฐะผ ะฐะฑัะพะปััะฝะฐั ัะธัะธะฝะฐ.",
            "๐ ะะฐัะฐัะตะนะบะธ ะธะทะพะฑัะตะปะธ ะฝะฐ 40 ะปะตั ัะฐะฝััะต, ัะตะผ ะฝะฐัะปะธ ะธะผ ะฟัะธะผะตะฝะตะฝะธะต.",
            "๐ฎ ะ ะฏะฟะพะฝะธะธ ะฑะพะปััะต ะถะธะฒะพัะฝัั ะฒ ะบะฐัะตััะฒะต ะดะพะผะฐัะฝะธั ะฟะธัะพะผัะตะฒ, ัะตะผ ะดะตัะตะน.",
            "๐ 95% ะผะธัะพะฒะพะณะพ ะพะบะตะฐะฝะฐ ะพััะฐัััั ะฝะตะธะทััะตะฝะฝัะผะธ.",
            "โ ะะพัะต - ะฒัะพัะพะน ะฟะพ ะพะฑัะตะผั ัะพัะณะพะฒะปะธ ัะพะฒะฐั ะฒ ะผะธัะต ะฟะพัะปะต ะฝะตััะธ.",
            "๐ ะัะตะปั ัะผะตัั ััะธัะฐัั ะดะพ ัะตัััะตั.",
            "๐งฌ ะะะ ัะตะปะพะฒะตะบะฐ ะฝะฐ 50% ัะพะฒะฟะฐะดะฐะตั ั ะะะ ะฑะฐะฝะฐะฝะฐ.",
            "๐ ะ ะบะพัะผะพัะต ะผะตัะฐะปะปะธัะตัะบะธะต ะฟะพะฒะตััะฝะพััะธ ะผะพะณัั ัะฐะผะพะฟัะพะธะทะฒะพะปัะฝะพ ัะฒะฐัะธะฒะฐัััั.",
            "๐ต ะัะทัะบะฐ ะผะพะถะตั ะธะทะผะตะฝััั ัะตัะดะตัะฝัะน ัะธัะผ ะธ ะบัะพะฒัะฝะพะต ะดะฐะฒะปะตะฝะธะต.",
            "๐ ะฃะปะธัะบะฐ ะผะพะถะตั ัะฟะฐัั ััะธ ะณะพะดะฐ ะฟะพะดััะด.",
            "๐ ะะปะผะฐะทั ะผะพะถะฝะพ ัะดะตะปะฐัั ะธะท ะฐัะฐัะธัะพะฒะพะณะพ ะผะฐัะปะฐ."
        ]
        return random.choice(facts)
    
    def get_joke(self) -> str:
        """
        ะะพะทะฒัะฐัะฐะตั ัะปััะฐะนะฝัั ัััะบั
        """
        jokes = [
            "ะัะพะณัะฐะผะผะธัั ะผะพะตั ะณะพะปะพะฒั ัะฐะผะฟัะฝะตะผ.\nะะฝััััะบัะธั: ะฝะฐะฝะตััะธ, ะฝะฐะผัะปะธัั, ัะผััั, ะฟะพะฒัะพัะธัั.\nะัะพะณัะฐะผะผะธัั ะฒัะต ะตัะต ะฒ ะดััะต...",
            "- ะกะบะพะปัะบะพ ะฟัะพะณัะฐะผะผะธััะพะฒ ะฝัะถะฝะพ, ััะพะฑั ะฒะบัััะธัั ะปะฐะผะฟะพัะบั?\n- ะะธ ะพะดะฝะพะณะพ, ััะพ ะฐะฟะฟะฐัะฐัะฝะฐั ะฟัะพะฑะปะตะผะฐ.",
            "ะะตะฒััะบะฐ ัะฟัะฐัะธะฒะฐะตั ะฟัะพะณัะฐะผะผะธััะฐ:\n- ะะธะปัะน, ััะพะดะธ ะฒ ะผะฐะณะฐะทะธะฝ ะทะฐ ัะปะตะฑะพะผ.\n- ะฅะพัะพัะพ, ะดะพัะพะณะฐั.\nะัะพะณัะฐะผะผะธัั ััะตะป ะธ ะฝะต ะฒะตัะฝัะปัั. ะะฝะฐ ะทะฐะฑัะปะฐ ัะบะฐะทะฐัั return.",
            "ะะพัะตะผั ะฟัะพะณัะฐะผะผะธััั ะฟััะฐัั ะฅัะปะปะพัะธะฝ ะธ ะะพะถะดะตััะฒะพ?\nะะพัะพะผั ััะพ OCT 31 = DEC 25 ๐",
            "- ะัะพ ัะฐะบะพะน full-stack ัะฐะทัะฐะฑะพััะธะบ?\n- ะญัะพ ัะตะปะพะฒะตะบ, ะบะพัะพััะน ัะผะตะตั ัะพะทะดะฐะฒะฐัั ะฑะฐะณะธ ะธ ะฒ ััะพะฝัะตะฝะดะต, ะธ ะฒ ะฑัะบะตะฝะดะต.",
            "ะะตะฝะฐ ะฟัะพะณัะฐะผะผะธััั:\n- ะะพัะพะณะพะน, ะบัะฟะธ ะฑะฐัะพะฝ ัะปะตะฑะฐ, ะฐ ะตัะปะธ ะฑัะดัั ัะนัะฐ - ะฒะพะทัะผะธ ะดะตัััะพะบ.\nะะฝ ะฟัะธัะตะป ั 10 ะฑะฐัะพะฝะฐะผะธ:\n- ะฏะนัะฐ ะฑัะปะธ!",
            "ะะฒะฐ ะฟัะพะณัะฐะผะผะธััะฐ ะณะพะฒะพััั:\n- ะฃ ะผะตะฝั bug.\n- ะ ั ะผะตะฝั feature!",
            "- ะะฐะบ ะฟัะพะณัะฐะผะผะธััั ะฝะฐะทัะฒะฐัั ัะฒะพะธ ะพัะธะฑะบะธ?\n- ะะตะดะพะบัะผะตะฝัะธัะพะฒะฐะฝะฝัะผะธ ัะธัะฐะผะธ! ๐",
        ]
        return random.choice(jokes)
    
    def get_motivational_quote(self) -> str:
        """
        ะะพะทะฒัะฐัะฐะตั ะผะพัะธะฒะฐัะธะพะฝะฝัั ัะธัะฐัั
        """
        quotes = [
            "๐ช \"ะะดะธะฝััะฒะตะฝะฝัะน ัะฟะพัะพะฑ ัะดะตะปะฐัั ะฒะตะปะธะบัั ัะฐะฑะพัั - ะปัะฑะธัั ัะพ, ััะพ ะดะตะปะฐะตัั.\" - ะกัะธะฒ ะะถะพะฑั",
            "๐ฏ \"ะะต ะฑะพะนัะตัั ะฝะฐัะฐัั ั ะผะฐะปะพะณะพ. ะะตะปะธะบะธะต ะดะตะปะฐ ะฝะฐัะธะฝะฐัััั ั ะผะฐะปัั ัะฐะณะพะฒ.\"",
            "๐ \"ะัะดััะตะต ะฟัะธะฝะฐะดะปะตะถะธั ัะตะผ, ะบัะพ ะฒะตัะธั ะฒ ะบัะฐัะพัั ัะฒะพะธั ะผะตััะฐะฝะธะน.\" - ะญะปะตะพะฝะพัะฐ ะัะทะฒะตะปัั",
            "โก \"ะฃัะฟะตั - ััะพ ัะฟะพัะพะฑะฝะพััั ะธะดัะธ ะพั ะฝะตัะดะฐัะธ ะบ ะฝะตัะดะฐัะต, ะฝะต ัะตััั ัะฝััะทะธะฐะทะผะฐ.\" - ะงะตััะธะปะปั",
            "๐ \"ะัััะตะต ะฒัะตะผั ะฟะพัะฐะดะธัั ะดะตัะตะฒะพ ะฑัะปะพ 20 ะปะตั ะฝะฐะทะฐะด. ะัะพัะพะต ะปัััะตะต ะฒัะตะผั - ัะตะณะพะดะฝั.\"",
            "๐ก \"ะะตะฒะพะทะผะพะถะฝะพ - ััะพ ะฒัะตะณะพ ะปะธัั ะณัะพะผะบะพะต ัะปะพะฒะพ, ะทะฐ ะบะพัะพััะผ ะฟััััััั ะผะฐะปะตะฝัะบะธะต ะปัะดะธ.\"",
            "๐จ \"ะัะตะฐัะธะฒะฝะพััั - ััะพ ะธะฝัะตะปะปะตะบั, ะบะพัะพััะน ัะฐะทะฒะปะตะบะฐะตััั.\" - ะะปัะฑะตัั ะญะนะฝััะตะนะฝ",
            "๐ \"ะะพะฑะตะดะฐ ะฝะฐัะธะฝะฐะตััั ั ะฝะฐัะฐะปะฐ. ะะฐัะฝะธ ะฟััะผะพ ัะตะนัะฐั.\"",
        ]
        return random.choice(quotes)
    
    async def get_random_activity(self) -> Optional[str]:
        """
        ะัะตะดะปะฐะณะฐะตั ัะปััะฐะนะฝัั ะฐะบัะธะฒะฝะพััั (ัะตัะตะท Bored API)
        """
        try:
            url = "https://www.boredapi.com/api/activity"
            async with aiohttp.ClientSession() as session:
                async with session.get(url, timeout=aiohttp.ClientTimeout(total=10)) as response:
                    if response.status == 200:
                        data = await response.json()
                        activity = data["activity"]
                        activity_type = data["type"]
                        return f"๐ก ะัะตะดะปะพะถะตะฝะธะต: {activity}\n๐ ะะฐัะตะณะพัะธั: {activity_type}"
            return None
        except Exception as e:
            print(f"โ ะัะธะฑะบะฐ ะฟะพะปััะตะฝะธั ะฐะบัะธะฒะฝะพััะธ: {e}")
            return None
    
    def get_tips(self, category: str = "productivity") -> str:
        """
        ะะพะทะฒัะฐัะฐะตั ัะพะฒะตัั ะฟะพ ัะฐะทะฝัะผ ะบะฐัะตะณะพัะธัะผ
        """
        tips = {
            "productivity": [
                "โฐ ะัะฟะพะปัะทัะน ัะตัะฝะธะบั ะะพะผะพะดะพัะพ: 25 ะผะธะฝัั ัะฐะฑะพัั, 5 ะผะธะฝัั ะพัะดัั.",
                "๐ ะะฐะฟะธััะฒะฐะน ะฒัะต ะทะฐะดะฐัะธ, ะพัะฒะพะฑะพะถะดะฐะน ะผะพะทะณ ะดะปั ัะฒะพััะตััะฒะฐ.",
                "๐ฏ ะะฐัะธะฝะฐะน ะดะตะฝั ั ัะฐะผะพะน ะฒะฐะถะฝะพะน ะทะฐะดะฐัะธ (Eat the Frog).",
                "๐ซ ะัะบะปััะฐะน ัะฒะตะดะพะผะปะตะฝะธั ะฝะฐ ะฒัะตะผั ะณะปัะฑะพะบะพะน ัะฐะฑะพัั.",
                "โ ะะตะปะฐะน ัะตะณัะปััะฝัะต ะฟะตัะตััะฒั ะบะฐะถะดัะต 90 ะผะธะฝัั.",
            ],
            "health": [
                "๐ง ะะตะน ะฝะต ะผะตะฝะตะต 2 ะปะธััะพะฒ ะฒะพะดั ะฒ ะดะตะฝั.",
                "๐ถ ะะตะปะฐะน ะฟะตัะตััะฒั ะฝะฐ ะฟัะพะณัะปะบั ะบะฐะถะดัะต 2 ัะฐัะฐ.",
                "๐ ะัะฐะฒะธะปะพ 20-20-20: ะบะฐะถะดัะต 20 ะผะธะฝัั ัะผะพััะธ ะฝะฐ ะพะฑัะตะบั ะฒ 20 ัััะฐั ะฝะฐ 20 ัะตะบัะฝะด.",
                "๐ง ะะตะดะธัะธััะน 10 ะผะธะฝัั ะฒ ะดะตะฝั ะดะปั ัะฝะธะถะตะฝะธั ัััะตััะฐ.",
                "๐ด ะกะฟะธ ะฝะต ะผะตะฝะตะต 7-8 ัะฐัะพะฒ ะดะปั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั.",
            ],
            "coding": [
                "๐ ะงะธัะฐะน ััะถะพะน ะบะพะด - ะปัััะธะน ัะฟะพัะพะฑ ััะธัััั.",
                "๐งช ะะธัะธ ัะตััั - ะพะฝะธ ัะบะพะฝะพะผัั ะฒัะตะผั ะฒ ะดะพะปะณะพััะพัะฝะพะน ะฟะตััะฟะตะบัะธะฒะต.",
                "๐ Code review - ัะฟัะฐัะธะฒะฐะน ะผะฝะตะฝะธะต ะบะพะปะปะตะณ ะพ ัะฒะพะตะผ ะบะพะดะต.",
                "๐ ะะพะบัะผะตะฝัะธััะน ะบะพะด ะดะปั ะฑัะดััะตะณะพ ัะตะฑั.",
                "โป๏ธ ะะตัะฐะบัะพัะธ ัะตะณัะปััะฝะพ, ะฝะต ะบะพะฟะธ ัะตัะฝะธัะตัะบะธะน ะดะพะปะณ.",
            ]
        }
        
        category_tips = tips.get(category, tips["productivity"])
        return random.choice(category_tips)
    
    def roll_dice(self, sides: int = 6, count: int = 1) -> Dict:
        """
        ะัะพัะฐะตั ะบะพััะธ
        """
        if sides < 2 or sides > 100:
            sides = 6
        if count < 1 or count > 10:
            count = 1
        
        rolls = [random.randint(1, sides) for _ in range(count)]
        total = sum(rolls)
        
        return {
            "rolls": rolls,
            "total": total,
            "count": count,
            "sides": sides
        }
    
    def magic_8ball(self, question: str = None) -> str:
        """
        ะะฐะณะธัะตัะบะธะน ัะฐั 8 - ะฟัะตะดัะบะฐะทะฐัะตะปั
        """
        responses = [
            "๐ฎ ะะฐ, ะพะฟัะตะดะตะปะตะฝะฝะพ!",
            "๐ฎ ะะตะท ัะพะผะฝะตะฝะธะน.",
            "๐ฎ ะะพะถะตัั ะฑััั ัะฒะตัะตะฝ.",
            "๐ฎ ะะฐ.",
            "๐ฎ ะกะบะพัะตะต ะฒัะตะณะพ ะดะฐ.",
            "๐ฎ ะะพะบะฐ ะฝะตััะฝะพ, ัะฟัะพัะธ ะฟะพะทะถะต.",
            "๐ฎ ะกะบะพะฝัะตะฝััะธััะนัั ะธ ัะฟัะพัะธ ัะฝะพะฒะฐ.",
            "๐ฎ ะัััะต ะฝะต ะณะพะฒะพัะธัั ัะตะนัะฐั.",
            "๐ฎ ะะต ะผะพะณั ะฟัะตะดัะบะฐะทะฐัั.",
            "๐ฎ ะะพะน ะพัะฒะตั - ะฝะตั.",
            "๐ฎ ะะพะธ ะธััะพัะฝะธะบะธ ะณะพะฒะพััั - ะฝะตั.",
            "๐ฎ ะัะตะฝั ัะพะผะฝะธัะตะปัะฝะพ.",
        ]
        
        response = random.choice(responses)
        
        if question:
            return f"โ {question}\n{response}"
        else:
            return response

